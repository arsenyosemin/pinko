{% extends 'layout.html' %}

{% block content %}
{% if product.id.endswith(config.SUBSCRIPTION_PLAN_ID) %}
    <div class="stamp-header">
        <div class="stamp">
            <div>Subscribe</div>
            <div>Subscribe</div>
        </div>
    </div>
{% endif %}
<div class="product">
    <div class="product--gallery">
        {% set images = images or [product.metadata.image] %}
        {% for img in (images[1:] if images|length > 1 else images)%}
            <figure>
                <img src="{{ img }}" />
            </figure>
        {% endfor %}
    </div>
    <div class="product--info">
        <h1>{{ product.name }}</h1>
        <p>{{ (product.description or product.metadata.description)|safe }}</p>

        {% if product.id.endswith(config.SUBSCRIPTION_PLAN_ID) %}
            <div id="mc_embed_signup">
                <form action="https://gmail.us3.list-manage.com/subscribe/post?{{ config.MC_LIST }}" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                    <div id="mc_embed_signup_scroll" style="display:flex;">
                        <div style="margin-right:0.5em;">
                            <div class="mc-field-group">
                                <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" aria-label="Email Address" placeholder="Email Address">
                            </div>
                            <div id="mce-responses" class="clear">
                                <div class="response" id="mce-error-response" style="display:none"></div>
                                <div class="response" id="mce-success-response" style="display:none"></div>
                            </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                            <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_5691622a06aeef8a0bcd466a9_8dee969cdd" tabindex="-1" value=""></div>
                        </div>
                        <div class="clear"><input type="submit" value="Subscribe to our newsletter" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                    </div>
                </form>
            </div>
        {% endif %}

        <div class="product--skus">
            {% if skus|length == 0 and prices|length == 0 %}
                <div>Not currently available.</div>
            {% endif %}
            {% for sku in skus %}
                <div class="product--sku">
                    <form action='{{ url_for('shop.cart') }}' method='POST'>
                        <input type='hidden' name='sku' value={{ sku.id }}>
                        <input type='hidden' name='product' value={{ product.id }}>
                        <input type='hidden' name='name' value='{{ product.name }} - {{ sku.attributes.values()|join(', ') }}'>
                        <div class="sku">
                            <div>
                                <div class="sku--name">{{ sku.attributes.values()|join(', ') }}</div>
                                <div class="sku--price">{{ '${:,.2f}'.format(sku.price/100) }}</div>
                            </div>
                            {% if sku.in_stock %}
                                <input type="submit" value='Add to Cart'>
                            {% else %}
                                <input type="submit" disabled value='Out of Stock'>
                            {% endif %}
                        </div>
                    </form>
                </div>
            {% endfor %}

            {% for price in prices %}
                <div class="product--sku">
                    <form action='{{ url_for('shop.subscribe' if price.recurring else 'shop.cart') }}' method='POST'>
                        <input type='hidden' name='sku' value={{ price.id }}>
                        <input type='hidden' name='product' value={{ product.id }}>
                        {% if price.nickname %}
                            <input type='hidden' name='name' value='{{ product.name }} - {{ price.nickname }}'>
                        {% else %}
                            <input type='hidden' name='name' value='{{ product.name }}'>
                        {% endif %}
                        {% if price.recurring %}
                            <input type='hidden' name='price' value='{{ '${:,.2f}'.format(price.unit_amount/100) }}/{% if price.recurring.interval_count > 1 %}{{ price.recurring.interval_count }} {% endif %}{{ price.recurring.interval }}{% if price.recurring.interval_count > 1 %}s{% endif %}'>
                        {% else %}
                            <input type='hidden' name='price' value='{{ '${:,.2f}'.format(price.unit_amount/100) }}'>
                        {% endif %}
                        <div class="sku">
                            <div>
                                <div class="sku--name">{{ price.nickname or product.name }}</div>
                                {% if price.recurring %}
                                    <div class="sku--price">{{ '${:,.2f}'.format(price.unit_amount/100) }}/{% if price.recurring.interval_count > 1 %}{{ price.recurring.interval_count }} {% endif %}{{ price.recurring.interval }}{% if price.recurring.interval_count > 1 %}s{% endif %}</div>
                                {% else %}
                                    <div class="sku--price">{{ '${:,.2f}'.format(price.unit_amount/100) }}</div>
                                {% endif %}
                            </div>
                            <input type="submit" value='{{ 'Subscribe' if price.recurring else 'Purchase' }}'>
                        </div>
                    </form>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% if product.id.endswith(config.SUBSCRIPTION_PLAN_ID) %}
<div id="faq">
    <h1>FAQ</h1>
    <ul>
        <li>
            <h2>How can I change my address or billing info?</h2>
            <p>Manage your <a href="/store/subscribe/manage">subscription settings here</a> or email us at <a href="mailto:subs@pinko.online">subs@pinko.online</a> and we will sort it out.</p>
        </li>
        <li>
            <h2>When can I expect to receive my copy in the mail?</h2>
            <p>Issues are arriving from the printer by the end of the month. We will hopefully be able to send them off the week following.</p>
        </li>
        <li>
            <h2>Do you ship internationally?</h2>
            <p>Yes! You should be able to sign up normally and the shipping will be automatically calculated. If you have any problems registering, email us at subs@pinko.online.</p>
        </li>
        <li>
            <h2>How can I carry Pinko in my bookstore, library or infoshop?</h2>
            <p>Fill out <a href="https://docs.google.com/forms/d/1_CjAGND8XNJ4e9lriS_Oc-gLi4itUeKX0kPKUWv0z8w/edit">this form here</a> and we'll be in touch about wholesale orders.</p>
        </li>
    </ul>
</div>
{% endif %}
{% endblock %}

